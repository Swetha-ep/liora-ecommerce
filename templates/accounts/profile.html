{% extends "base.html" %}
{% load static %}
{% block title %}L I O R A | Profile{% endblock %}
{% block content %}
   

    <!-- Breadcrumb Section Begin -->
    <section class="breadcrumb-option">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="breadcrumb__text">
                        <h4>Profile</h4>
                        <div class="breadcrumb__links">
                            <a href="./index.html">Home</a>
                            <a href="{% url 'shop' %}">Shop</a>
                            <span>Profile</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- Breadcrumb Section End -->

    <!-- Checkout Section Begin -->
    <section class="checkout spad">
        <div class="container">
            <div class="checkout__form">
                <h4 class="card-title text-center mb-4">Profile Details</h4>
                <form method="POST" action="">
                    {% csrf_token %}
                    <div class="row">
                        <input type="hidden" name="product_id" value="{{ inventory.product.id }}">
                        <input type="hidden" name="size_id" value="{{ inventory.size.id }}">
                        <input type="hidden" name="color_id" value="{{ inventory.color.id }}">
                        <input type="hidden" name="quantity" value="{{ quantity }}">

                        <div class="col-lg-8 col-md-6"> 
                            
                            <div class="card shadow-sm rounded-lg p-3 mb-4" style="max-width: 500px; margin: auto;">
                                <div class="card-body text-center">
                                    <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQSWI6VpVy-ntX4gy-cV4f2qbRyVJQJdhU3Ew&s" alt="Profile Picture" class="rounded-circle mb-3" width="120" height="120" style="object-fit: cover;">

                                    <ul class="list-group list-group-flush">
                                    <li class="list-group-item d-flex justify-content-between">
                                        <strong>Username:</strong>
                                        <span>{{ user.username }}</span>
                                    </li>
                                    <li class="list-group-item d-flex justify-content-between">
                                        <strong>Email:</strong>
                                        <span>{{ user.email }}</span>
                                    </li>
                                    <div class="text-center mt-4">
                                    <a href="" class="btn btn-sm btn-outline-dark">Edit Profile</a>
                                    </div>
                                </div>
                            </div>
  
                        </div>

                   
                        <div class="col-lg-4 col-md-6">

                            <!-- ðŸª™ Wallet Section Start -->
    <div class="checkout__order mb-4">
        <h4 class="mb-3">ðŸ’° My Wallet</h4>
        <div class="border rounded p-3 mb-3" style="background-color: #f9f9f9;">
            <div class="d-flex justify-content-between align-items-center">
                <strong>Current Balance:</strong>
                <span class="text-success font-weight-bold">â‚¹{{ wallet.balance }}</span>
            </div>
        </div>

        {% if transactions %}
            <h6 class="mb-2">Recent Transactions</h6>
            <ul class="list-group list-group-flush mb-3">
                {% for tx in transactions %}
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        <small>{{ tx.description }}</small>
                        {% if tx.amount > 0 %}
                            <small class="text-success">+ â‚¹{{ tx.amount }}</small>
                        {% else %}
                            <small class="text-danger">â‚¹{{ tx.amount }}</small>
                        {% endif %}
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p class="text-muted mb-0">No transactions yet.</p>
        {% endif %}
    </div>
    <!-- ðŸª™ Wallet Section End -->

                            <div class="checkout__order">
                            {% for addr in addresses %}
                                
                                <div class="col-12 mb-2">
                                    <div class="border rounded p-3 d-flex justify-content-between align-items-center" style="background-color: #f9f9f9;">
                                        <div>
                                        <div><strong>{{ addr.name }}</strong></div>
                                        <div>{{ addr.city }} - {{ addr.pincode }}</div>
                                        
                                        </div>

                                        <div class="text-end">
                                        <button type="button"
                                                class="btn btn-sm btn-outline-secondary"
                                                data-toggle="modal"
                                                data-target="#viewAddressModal"
                                                data-name="{{ addr.name }}"
                                                data-phone="{{ addr.phone }}"
                                                data-lineone="{{ addr.address_line1 }}"
                                                data-linetwo="{{ addr.address_line2 }}"
                                                data-city="{{ addr.city }}"
                                                data-state="{{ addr.state }}"
                                                data-country="{{ addr.country }}"
                                                data-pincode="{{ addr.pincode }}">
                                            View
                                        </button>
                                        </div>
                                    </div>
                                </div>
                                {% empty %}
                                    <p>No address found. Go to ur profile and add one.</p>
                                {% endfor %}
                                <button type="button" class="btn  site-btn ml-4 text-white"
                                data-toggle="modal"
                                data-target="#AddAddressModal">
                                    Add address
                                </button>
                            </div>
                        </div>
                    </div>
                </form>

                <!-- Address Detail Modal -->
                        <div class="modal fade" id="viewAddressModal" tabindex="-1" role="dialog" aria-labelledby="viewAddressModalLabel" aria-hidden="true">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="viewAddressModalLabel">Address Details</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">
                                <div class="row mb-2">
                                    <div class="col-5 text-end fw-semibold">Name:</div>
                                    <div class="col-7" id="modalName"></div>
                                </div>
                                <div class="row mb-2">
                                    <div class="col-5 text-end fw-semibold">Phone:</div>
                                    <div class="col-7" id="modalPhone"></div>
                                </div>
                                <div class="row mb-2">
                                    <div class="col-5 text-end fw-semibold">Address Line 1:</div>
                                    <div class="col-7" id="modalLine1"></div>
                                </div>
                                <div class="row mb-2">
                                    <div class="col-5 text-end fw-semibold">Address Line 2:</div>
                                    <div class="col-7" id="modalLine2"></div>
                                </div>
                                <div class="row mb-2">
                                    <div class="col-5 text-end fw-semibold">City:</div>
                                    <div class="col-7" id="modalCity"></div>
                                </div>
                                <div class="row mb-2">
                                    <div class="col-5 text-end fw-semibold">State:</div>
                                    <div class="col-7" id="modalState"></div>
                                </div>
                                <div class="row mb-2">
                                    <div class="col-5 text-end fw-semibold">Country:</div>
                                    <div class="col-7" id="modalCountry"></div>
                                </div>
                                <div class="row mb-2">
                                    <div class="col-5 text-end fw-semibold">Pincode:</div>
                                    <div class="col-7" id="modalPincode"></div>
                                </div>
                                </div>

                            </div>
                        </div>
                        </div>

                
                <!-- Address creation Modal -->
                        <div class="modal fade" id="AddAddressModal" tabindex="-1" role="dialog" aria-labelledby="AddAddressModalLabel" aria-hidden="true">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <form method="POST" action ="{% url 'add_address' %}">
                                    {% csrf_token %}
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="viewAddressModalLabel">Address Details</h5>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                        </button>
                                    </div>
                                    <div class="modal-body">
                                        {{form.as_p}}
                                    </div>
                                    <div class="modal-footer">
                                        <button type="submit" class="btn btn-dark">Save Address</button>
                                    </div>
                                </form>
                        </div>
                        </div>
                

            </div>
        </div>
    </section>
    <!-- Profile Section End -->
     <!-- jQuery (must come first) -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- Bootstrap 4 JS -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <script>
        $('#viewAddressModal').on('show.bs.modal', function (event) {
            const button = $(event.relatedTarget);
            $('#modalName').text(button.data('name'));
            $('#modalPhone').text(button.data('phone'));
            $('#modalLine1').text(button.data('lineone'));
            $('#modalLine2').text(button.data('linetwo'));
            $('#modalCity').text(button.data('city'));
            $('#modalState').text(button.data('state'));
            $('#modalCountry').text(button.data('country'));
            $('#modalPincode').text(button.data('pincode'));
        });
    </script>

{% endblock content %}